# STM32F103C8T6综合学习项目结构设计

## 1. 项目功能概述
- 实时监测环境光强和温度
- 检测设备姿态（俯仰角、横滚角）
- 通过旋转编码器和按钮调节参数
- OLED显示系统状态
- LED指示系统工作状态
- 异常状态蜂鸣器报警
- 根据姿态控制舵机角度

## 2. 硬件模块选择
1. OLED显示屏（I2C）
2. 蜂鸣器模块（GPIO）
3. 光敏电阻传感器（ADC）
4. 热敏电阻传感器（ADC）
5. MPU6050陀螺仪（I2C）
6. 旋转编码器（EXTI+TIM）
7. 舵机（PWM）
8. LED指示灯（GPIO）
9. 按钮（GPIO+EXTI）

## 3. 文件结构设计

### 3.1 硬件驱动层
```
Hardware/
├── pinconfig.c
├── OLED.c
├── OLED.h
├── OLED_Font.h
├── beeper.c
├── beeper.h
├── light_sensor.c
├── light_sensor.h
├── temp_sensor.c
├── temp_sensor.h
├── mpu6050.c
├── mpu6050.h
├── encoder.c
├── encoder.h
├── servo.c
├── servo.h
├── led.c
├── led.h
├── button.c
└── button.h
```

### 3.2 中间件层
```
Middlewares/
├── i2c.c
├── i2c.h
├── delay.c
└── delay.h
```

### 3.3 应用层
```
Application/
├── system.c
└── system.h
```

### 3.4 主程序
```
User/
├── main.c
└── stm32f10x_it.c
```

## 4. 新增功能模块说明

### 4.8 LED指示灯模块
- 功能：系统状态指示
- 接口：GPIO
- 实现：
  - 初始化LED GPIO
  - 状态指示模式：
    - 系统运行状态
    - 报警状态
    - 模式切换指示
  - 呼吸灯效果

### 4.9 按钮模块
- 功能：用户输入控制
- 接口：GPIO+EXTI
- 实现：
  - 按钮初始化
  - 按键消抖处理
  - 按键事件：
    - 短按
    - 长按
    - 双击
  - 功能分配：
    - 模式切换
    - 参数确认
    - 报警确认

## 5. 状态指示灯设计
| LED编号 | 颜色  | 功能描述                     |
|---------|-------|------------------------------|
| LED1    | 绿色  | 系统正常运行                 |
| LED2    | 蓝色  | 数据采集进行中               |
| LED3    | 黄色  | 参数设置模式                 |
| LED4    | 红色  | 系统报警状态                 |

## 6. 按钮功能分配
| 按钮编号 | 功能描述                     |
|----------|------------------------------|
| BTN1     | 模式切换（短按）             |
| BTN2     | 参数确认/选择（短按）        |
| BTN3     | 报警确认（短按）             |
| BTN4     | 系统复位（短按）          |

## 7. 系统工作流程
1. 上电初始化
2. LED指示灯自检
3. 传感器校准
4. 进入主循环：
   - 数据采集
   - 状态检测
   - 用户输入处理
   - 状态显示
   - 异常处理
5. 根据模式切换功能：
   - 监测模式
   - 设置模式
   - 调试模式

## 8. 学习要点补充
1. GPIO输入输出配置
2. 按键消抖处理
3. 状态指示灯控制
4. 用户交互设计
5. 系统状态管理
